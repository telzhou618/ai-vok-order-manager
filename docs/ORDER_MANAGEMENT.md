# 订单管理功能说明

## 功能概述

订单管理模块提供订单查询和详情查看功能，支持按订单号或用户ID查询订单数据。

## 页面访问

- **路由**: `/orders`
- **菜单**: 侧边栏 "订单管理"
- **权限**: 暂不控制权限，所有登录用户均可访问

## 功能特性

### 1. 查询功能

- **订单号查询**: 输入完整订单号精确查询
- **用户ID查询**: 输入用户ID查询该用户的所有订单
- **组合查询**: 可同时输入订单号和用户ID进行查询
- **必填验证**: 至少需要输入订单号或用户ID之一

### 2. 列表展示

订单列表显示以下信息：

- **基本信息**: ID、订单号、用户ID
- **状态信息**: 订单状态、支付状态（带颜色标识）
- **金额信息**: 实付金额
- **支付信息**: 支付方式
- **收货信息**: 收货人、联系电话
- **其他信息**: 订单来源、创建时间
- **操作**: 查看详情按钮

#### 状态颜色说明

**订单状态**:
- 🟠 待付款 - 橙色
- 🔵 已付款 - 蓝色
- 🟣 已发货 - 紫色
- 🟢 已完成 - 绿色
- 🔴 已取消/已关闭 - 红色

**支付状态**:
- ⚪ 未支付 - 灰色
- 🟢 支付成功 - 绿色
- 🔴 支付失败 - 红色
- 🟠 已退款/退款中 - 橙色

### 3. 订单详情

点击"详情"按钮可查看订单完整信息：

- **基本信息**: 订单号、订单ID、用户ID、订单状态、支付状态
- **金额信息**: 订单总金额、优惠金额、运费、实付金额、支付方式、支付时间
- **收货信息**: 收货人、联系电话、收货地址
- **物流信息**: 物流公司、物流单号、发货时间、收货时间（如有）
- **其他信息**: 订单来源、创建时间、订单备注、取消原因（如有）

## 数据库准备

### 1. 创建分表

执行 `sql/order_sharding.sql` 创建 `order_0` 和 `order_1` 两张分表：

```bash
mysql -u root -p rbac_db < sql/order_sharding.sql
```

### 2. 插入测试数据

执行 `sql/order_test_data.sql` 插入测试数据：

```bash
mysql -u root -p rbac_db < sql/order_test_data.sql
```

测试数据包含：
- 用户 1000: 3个订单（路由到 order_0）
- 用户 1001: 3个订单（路由到 order_1）
- 用户 1002: 2个订单（路由到 order_0）
- 用户 1003: 2个订单（路由到 order_1）

## 使用示例

### 示例 1: 按用户ID查询

1. 在"用户ID"输入框输入: `1000`
2. 点击"查询"按钮
3. 系统会显示用户 1000 的所有订单（3条）

### 示例 2: 按订单号查询

1. 在"订单号"输入框输入: `ORD202602060001`
2. 点击"查询"按钮
3. 系统会显示该订单的详细信息（1条）

### 示例 3: 查看订单详情

1. 在列表中找到目标订单
2. 点击"详情"按钮
3. 弹出对话框显示订单完整信息

### 示例 4: 重置查询

1. 点击"重置"按钮
2. 清空所有查询条件
3. 列表恢复为空

## 技术实现

### 分表路由

- 使用 ShardingSphere 按 `user_id` 取模分表
- `user_id % 2 = 0` → `order_0`
- `user_id % 2 = 1` → `order_1`
- Mapper 使用 `@DS("sharding")` 注解自动路由

### 查询优化

- **推荐**: 使用用户ID查询（带分片键，单表查询，性能好）
- **可用**: 使用订单号查询（不带分片键，全表扫描，性能较差）

### 性能建议

1. 优先使用用户ID查询
2. 避免频繁的订单号查询
3. 如需按订单号查询，考虑建立订单号到用户ID的映射表

## 注意事项

1. **必填验证**: 查询时必须输入订单号或用户ID
2. **数据格式**: 用户ID必须是数字
3. **空数据**: 默认不显示任何数据，需要查询后才显示
4. **分表感知**: 用户无需关心分表逻辑，系统自动处理
5. **权限控制**: 当前版本暂不控制权限，后续可根据需要添加

## 后续扩展

可以考虑添加以下功能：

1. 订单创建/编辑功能
2. 订单状态流转（付款、发货、完成等）
3. 批量操作（批量发货、批量导出等）
4. 高级筛选（按状态、时间范围、金额范围等）
5. 分页功能（当前为全量查询）
6. 权限控制（按角色控制操作权限）
